<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Geocode BBox – Minimal UI</title>
    <meta name="robots" content="noindex" />
    <link rel="icon" href="data:," />
    <style>
      :root { color-scheme: light dark; }
      * { box-sizing: border-box; }
      body { margin: 0; font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      header { padding: 14px 16px; border-bottom: 1px solid #ccc; }
      main { padding: 16px; display: grid; gap: 16px; grid-template-columns: 1fr; }
      form { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
      input[type="text"], input[type="password"] { flex: 1 1 420px; padding: 10px 12px; border: 1px solid #888; border-radius: 8px; }
      input[type="text"] { min-width: 260px; }
      button { padding: 10px 14px; border-radius: 8px; border: 1px solid #555; background: #0b5; color: #fff; cursor: pointer; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }
      .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
      .small { font-size: 12px; color: #666; }
      .grid { display: grid; gap: 12px; grid-template-columns: 1fr; }
      .card { border: 1px solid #ccc; border-radius: 10px; padding: 12px; }
      .error { color: #b00; }
      pre { margin: 0; white-space: pre-wrap; word-break: break-word; }
      iframe { width: 100%; height: 420px; border: 1px solid #ccc; border-radius: 10px; }
      @media (min-width: 980px) { main { grid-template-columns: 1fr 1fr; } }
    </style>
  </head>
  <body>
    <header>
      <div class="row">
        <strong>Geocode Bounding Box</strong>
        <span class="small">– Enter an address, get bbox + map</span>
      </div>
    </header>
    <main>
      <section class="card">
        <form id="form">
          <input id="q" type="text" placeholder="1600 Amphitheatre Pkwy, Mountain View, CA" autocomplete="off" />
          <input id="token" type="password" placeholder="Optional Bearer token" autocomplete="off" />
          <button id="btn" type="submit">Search</button>
        </form>
        <div class="small">Requests GET <code>/geocode/bbox?q=...</code> on this server.</div>
        <div id="status" class="small"></div>
      </section>

      <section class="grid">
        <div class="card">
          <div><strong>Result JSON</strong></div>
          <pre id="out">No result yet.</pre>
        </div>
        <div class="card">
          <div class="row"><strong>Map Preview</strong><span class="small">(opens session HTML)</span></div>
          <iframe id="map" title="Map preview" src="about:blank"></iframe>
        </div>
      </section>
    </main>

    <script>
      const el = (id) => document.getElementById(id);
      const form = el('form');
      const q = el('q');
      const token = el('token');
      const btn = el('btn');
      const out = el('out');
      const map = el('map');
      const status = el('status');

      function setBusy(b) { btn.disabled = b; status.textContent = b ? 'Loading…' : ''; }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const query = q.value.trim();
        if (!query) { q.focus(); return; }
        const headers = { 'Accept': 'application/json' };
        if (token.value.trim()) headers['Authorization'] = 'Bearer ' + token.value.trim();
        const url = '/geocode/bbox?q=' + encodeURIComponent(query);
        setBusy(true);
        out.textContent = '';
        map.src = 'about:blank';
        try {
          const resp = await fetch(url, { headers });
          const data = await resp.json().catch(() => ({}));
          if (!resp.ok) {
            out.textContent = JSON.stringify({ error: data.error || 'request_failed', status: resp.status }, null, 2);
            status.innerHTML = '<span class="error">Error ' + resp.status + '</span>';
            return;
          }
          out.textContent = JSON.stringify(data, null, 2);
          if (data && data.mapUrl) {
            map.src = data.mapUrl;
          }
          status.textContent = 'Done.';
        } catch (err) {
          out.textContent = JSON.stringify({ error: 'network_error' }, null, 2);
          status.innerHTML = '<span class="error">Network error</span>';
        } finally {
          setBusy(false);
        }
      });
    </script>
  </body>
  </html>

